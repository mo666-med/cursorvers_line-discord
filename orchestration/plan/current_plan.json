{
  "title": "å‹ã ã¡ç™»éŒ²æ™‚ã®ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡",
  "risk": {
    "level": "low",
    "reasons": ["å®šå‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿", "å€‹äººæƒ…å ±ãªã—"],
    "approval": "not_required"
  },
  "steps": [
    {
      "id": "s1",
      "action": "line.get_profile",
      "connector": "line_bot",
      "payload": {
        "user_id": "{{LINE_USER_ID}}"
      },
      "idempotency_key": "{{EVENT_ID}}-s1",
      "on_error": "abort"
    },
    {
      "id": "s2",
      "action": "supabase.upsert",
      "connector": "supabase",
      "payload": {
        "table": "line_members",
        "data": {
          "line_user_id": "{{LINE_USER_ID}}",
          "display_name": "{{PROFILE.displayName}}",
          "picture_url": "{{PROFILE.pictureUrl}}",
          "status_message": "{{PROFILE.statusMessage}}",
          "language": "{{PROFILE.language}}",
          "registered_at": "{{NOW}}",
          "last_active_at": "{{NOW}}",
          "is_blocked": false,
          "metadata": {}
        }
      },
      "idempotency_key": "{{EVENT_ID}}-s2",
      "on_error": "abort"
    },
    {
      "id": "s3",
      "action": "line.reply",
      "connector": "line_bot",
      "payload": {
        "reply_token": "{{REPLY_TOKEN}}",
        "messages": [
          {
            "type": "text",
            "text": "ã¯ã˜ã‚ã¾ã—ã¦ï¼mo666ã§ã™ã€‚\nå‹ã ã¡è¿½åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ğŸ™\n\nã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯ã€æœ€æ–°æƒ…å ±ã‚’å®šæœŸçš„ã«é…ä¿¡ã—ã¦ã„ãã¾ã™ğŸ’Œ\nã©ã†ããŠæ¥½ã—ã¿ã«ğŸâœ¨\n\nã€åŒ»ç™‚å®‰å…¨ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ã€‘ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯åŒ»ç™‚è€…ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¨ºæ–­/æ²»ç™‚/ç”¨é‡ç­‰ã®å€‹åˆ¥åŠ©è¨€ã¯è¡Œã„ã¾ã›ã‚“ã€‚ä¸€èˆ¬æƒ…å ±ã®æ•´ç†ã¨å®‰å…¨æ¡ˆå†…ã®ã¿æä¾›ã—ã¾ã™ã€‚ç·Šæ€¥ã®ç–‘ã„ãŒã‚ã‚Œã°ç›´ã¡ã«æ•‘æ€¥ã¸ã€‚å€‹äººãŒç‰¹å®šã•ã‚Œå¾—ã‚‹æƒ…å ±ã¯å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ã€‚"
          }
        ]
      },
      "idempotency_key": "{{EVENT_ID}}-s3",
      "on_error": "compensate"
    }
  ],
  "rollback": [
    "s2: Supabaseã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆline_user_id={{LINE_USER_ID}}ï¼‰"
  ],
  "observability": {
    "success_metrics": [
      "line_members.count",
      "line.reply.success"
    ],
    "logs": [
      "stepæ¯ã®latency",
      "retries",
      "idempotency_key"
    ]
  }
}
